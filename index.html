<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rapid Reflex</title>
    <style>
      .container {
          display: grid;
          place-items: center;
          height: 10vh; /* Full viewport height */
      }
  </style>
  </head>
  <body>
    <section id="section1">
      <h2>Enter Your Name</h2>
      <form id="dataForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required />
        <br /><br />
        <h2>How fast can your react?</h2>
        Your goal is to see how fast you can click the button after it changes to red. Your name and results will be recorded and displayed on the leaderboard.
        If you try to cheat by clicking the button before it turns red, you will be disqualified and your time will not be recorded.
        When you are ready to compete for the fastest reaction time, click START or press Enter!
        <br /><br />
        <button type="submit">START</button>
      </form>
      <br /><br />
      <div class="container">
        <button id="colorButton" style="background-color: green; color: white; border-radius: 50%; width: 100px; height: 100px;">Click Me!</button>
      </div>
      
    </section>
    <section id="section2">
      <h2>Leaderboard:</h2>
      <ul id="userList"></ul>
    </section>

    <script>
      let name = "";
      let startTime;
      let reactionTime;
      let disqualified = false;
      let startClicked = false;
      let falseStart = true;

      document
        .getElementById("dataForm")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // Prevent the default form submission

          startClicked = true;
          falseStart = false;

          // Get form data
          name = document.getElementById("name").value;

          if (document.getElementById("colorButton").style.backgroundColor === "red") {
            document.getElementById("colorButton").style.backgroundColor = "green";
          }
          if (name) {
        const delay = Math.floor(Math.random() * 5000) + 1000; // Random delay between 1 and 6 seconds
        disqualified = false;
        setTimeout(() => {
          document.getElementById("colorButton").style.backgroundColor = "red";
          startTime = new Date().getTime(); // Get the start time when the button changes color
        }, delay);

          } else {
        alert("Please enter your name first.");
          }
        });
      document
        .getElementById("colorButton")
        .addEventListener("click", function () {
        if (!startClicked) {
          alert("Please click START first.");
          falseStart = true;
          return;
        }

        if (this.style.backgroundColor === "green") {
          alert("Wait for the button to turn red before clicking! This run is disqualified. Please click START to try again.");
          disqualified = true;
        }
          else{
            this.style.backgroundColor = "green";
            if (disqualified) {
              return;
            }
          const currentTime = new Date().getTime();
          reactionTime = (currentTime - startTime)/1000;
          }
        });
      document
        .getElementById("colorButton")
        .addEventListener("click", function () {
        
        if (falseStart) {
          return;
        }
        if (this.style.backgroundColor === "red" && disqualified) {
          this.style.backgroundColor = "green";
          return;
        }
        if (disqualified) {
          return;
        }
        // Send data to Web Server in the body of fetch request
        fetch("/input", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ name: name, reactionTime: reactionTime }),
        })
          .then((response) => response.json())
          .then((data) => {
            // Clear the current list
            const userList = document.getElementById("userList");
            userList.innerHTML = "";

            // Populate the list with updated users
            data.forEach((user) => {
          const li = document.createElement("li");
          li.textContent = `${user.name} ${user.reactionTime}`;
          userList.appendChild(li);
            });

            // Clear the form inputs
            document.getElementById("name").value = "";
            name = ""; // Reset the name variable
          })
          .catch((error) => console.error("Error:", error));
        });
        </script>
  </body>
</html>